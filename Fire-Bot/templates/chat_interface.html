<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link href="../static/css/chat_interface.css" rel="stylesheet">
</head>
<body>

<h1>Upload an Image</h1>
{% if error %}
    <p style="color: red;">{{ error }}</p>
{% endif %}
<form action="/" method="post" enctype="multipart/form-data">
    <input type="file" name="file" accept="image/*" required>
    <br><br>
    <button type="submit">Submit</button>
</form>

<div id="chat-icon">
    <img src="{{ url_for('static', filename='/img/chat-icon.jpeg')}}" alt="Chat Icon" width="50px" height="50px" onclick="toggleChatbot()">
</div>

<div class="crypt">
    <input type="text" id="textInput" placeholder="Enter text to encrypt">
    <button onclick="encryptText()">Encrypt Text</button>

    <!-- File Decryption -->
    <input type="file" id="fileInput">
    <button onclick="decryptFile()">Decrypt File</button>
</div>

<div id="chatbot-container" class="hide">
  <div class="top_part">
      <img src="{{ url_for('static', filename='/img/chat-icon.jpeg')}}" alt="">
      <p>Fire-Bot</p>
  </div>
  <div id="chat-container"></div>
  <input type="text" id="user-input" placeholder="Type your message...">
  <button onclick="sendMessage()">Send</button>
  <button onclick="startSpeechRecognition()">Start Speech Recognition</button>
</div>

<script>
    function toggleChatbot() {
        document.getElementById("chatbot-container").style.display = "block";
    }

    function sendMessage() {
        var userInput = $('#user-input').val();
        var chatContainer = $('#chat-container');
        chatContainer.append('<p>You: ' + userInput + '</p>');

        $.ajax({
            type: 'POST',
            url: '/chat',
            contentType: 'application/json',
            data: JSON.stringify({ input: userInput }),
            success: function(data) {
                chatContainer.append('<p>Chatbot: ' + data.response + '</p>');
            },
            error: function(error) {
                console.error('Error:', error);
            }
        });

        $('#user-input').val('');
    }

    function startSpeechRecognition() {
    if ('webkitSpeechRecognition' in window) {
        var recognition = new webkitSpeechRecognition(); // Create speech recognition object
        recognition.lang = 'en-US'; // Set recognition language to English

        // Define event handlers
        recognition.onresult = function(event) {
            var transcript = event.results[0][0].transcript; // Get recognized speech
            $('#user-input').val(transcript); // Set recognized speech as user input
        };

        recognition.onerror = function(event) {
            console.error('Speech recognition error:', event.error);
        };

        // Start speech recognition
        recognition.start();
    } else {
        alert('Speech recognition is not supported in this browser.');
    }
}
</script>

<script>
 function encryptText() {
    var text = document.getElementById("textInput").value;
    var key = "your-secret-key"; // Replace with your actual encryption key

    // Encrypt text
    var encrypted = encryptMessage(text, key);

    if (encrypted) {
        // Save encrypted text to a file
        saveToFile(encrypted);
    } else {
        // Handle case where no encrypted text is generated
        alert("Encryption failed. Please check your input and try again.");
    }
}

function encryptMessage(text, key) {
    // Your encryption logic here
    // Example using CryptoJS AES encryption
    var encrypted = CryptoJS.AES.encrypt(text, key);
    return encrypted.toString();
}

function saveToFile(text) {
    // Your code to save text to a file here
    // For example, you can create a Blob and download it as a file
    var blob = new Blob([text], { type: "text/plain" });
    var url = window.URL.createObjectURL(blob);
    var a = document.createElement("a");
    a.href = url;
    a.download = "encrypted_text.txt";
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
}


function decryptFile() {
    var fileInput = document.getElementById("fileInput");
    var file = fileInput.files[0];
    if (file) {
        var reader = new FileReader();
        reader.onload = function(event) {
            var encryptedText = event.target.result;
            var key = "your-secret-key"; // Replace with your actual encryption key
            
            // Decrypt text
            var decrypted = decryptMessage(encryptedText, key);
            
            if (decrypted) {
                // Display decrypted text
                alert("Decrypted Text: " + decrypted);
            } else {
                alert("Decryption failed. Please check the encrypted text and try again.");
            }
        };
        reader.readAsText(file);
    } else {
        alert("Please select a file to decrypt.");
    }
}

function decryptMessage(encryptedText, key) {
    try {
        // Decrypt using CryptoJS AES decryption
        var decryptedBytes = CryptoJS.AES.decrypt(encryptedText, key);
        var decryptedText = decryptedBytes.toString(CryptoJS.enc.Utf8);
        return decryptedText;
    } catch (error) {
        console.error("Decryption error:", error);
        return null;
    }
}


</script>
</body>
</html>